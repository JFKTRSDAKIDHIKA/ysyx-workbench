// Generated by CIRCT firtool-1.62.0
module LSU(	// src/main/scala/npc/lsu.scala:42:7
  input         clock,	// src/main/scala/npc/lsu.scala:42:7
                reset,	// src/main/scala/npc/lsu.scala:42:7
  output        io_in_ready,	// src/main/scala/npc/lsu.scala:43:14
  input         io_in_valid,	// src/main/scala/npc/lsu.scala:43:14
  input  [31:0] io_in_bits_inst,	// src/main/scala/npc/lsu.scala:43:14
                io_in_bits_pc,	// src/main/scala/npc/lsu.scala:43:14
                io_in_bits_dmem_addr,	// src/main/scala/npc/lsu.scala:43:14
                io_in_bits_result,	// src/main/scala/npc/lsu.scala:43:14
                io_in_bits_rs2_data,	// src/main/scala/npc/lsu.scala:43:14
  input  [4:0]  io_in_bits_wb_addr,	// src/main/scala/npc/lsu.scala:43:14
  input         io_out_ready,	// src/main/scala/npc/lsu.scala:43:14
  output        io_out_valid,	// src/main/scala/npc/lsu.scala:43:14
  output [31:0] io_out_bits_inst,	// src/main/scala/npc/lsu.scala:43:14
                io_out_bits_pc,	// src/main/scala/npc/lsu.scala:43:14
                io_out_bits_dmem_rdata,	// src/main/scala/npc/lsu.scala:43:14
                io_out_bits_result,	// src/main/scala/npc/lsu.scala:43:14
  output [4:0]  io_out_bits_wb_addr,	// src/main/scala/npc/lsu.scala:43:14
  output        io_lsu_axi_resp_err,	// src/main/scala/npc/lsu.scala:43:14
  output [31:0] io_memory_aw_addr,	// src/main/scala/npc/lsu.scala:43:14
  output [2:0]  io_memory_aw_size,	// src/main/scala/npc/lsu.scala:43:14
  output        io_memory_aw_valid,	// src/main/scala/npc/lsu.scala:43:14
  input         io_memory_aw_ready,	// src/main/scala/npc/lsu.scala:43:14
  output [31:0] io_memory_w_data,	// src/main/scala/npc/lsu.scala:43:14
  output [3:0]  io_memory_w_strb,	// src/main/scala/npc/lsu.scala:43:14
  output        io_memory_w_last,	// src/main/scala/npc/lsu.scala:43:14
                io_memory_w_valid,	// src/main/scala/npc/lsu.scala:43:14
  input         io_memory_w_ready,	// src/main/scala/npc/lsu.scala:43:14
  input  [1:0]  io_memory_b_resp,	// src/main/scala/npc/lsu.scala:43:14
  input         io_memory_b_valid,	// src/main/scala/npc/lsu.scala:43:14
  output        io_memory_b_ready,	// src/main/scala/npc/lsu.scala:43:14
  output [31:0] io_memory_ar_addr,	// src/main/scala/npc/lsu.scala:43:14
  output [2:0]  io_memory_ar_size,	// src/main/scala/npc/lsu.scala:43:14
  output        io_memory_ar_valid,	// src/main/scala/npc/lsu.scala:43:14
  input         io_memory_ar_ready,	// src/main/scala/npc/lsu.scala:43:14
  input  [31:0] io_memory_r_data,	// src/main/scala/npc/lsu.scala:43:14
  input  [1:0]  io_memory_r_resp,	// src/main/scala/npc/lsu.scala:43:14
  input         io_memory_r_valid,	// src/main/scala/npc/lsu.scala:43:14
  output        io_memory_r_ready,	// src/main/scala/npc/lsu.scala:43:14
                io_arbiter_valid,	// src/main/scala/npc/lsu.scala:43:14
  input         io_arbiter_ready,	// src/main/scala/npc/lsu.scala:43:14
  output [2:0]  io_lsu_state_debug,	// src/main/scala/npc/lsu.scala:43:14
  output        io_lsu_is_ld_or_st_debug,	// src/main/scala/npc/lsu.scala:43:14
  output [31:0] io_lsu_reg_inst_debug,	// src/main/scala/npc/lsu.scala:43:14
                io_dmem_wdata_debug,	// src/main/scala/npc/lsu.scala:43:14
                io_dmem_rdata_debug,	// src/main/scala/npc/lsu.scala:43:14
                io_lsu_reg_dmem_addr_debug	// src/main/scala/npc/lsu.scala:43:14
);

  wire        isStore;	// src/main/scala/npc/lsu.scala:66:25, :102:17, :111:15
  wire        isLoad;	// src/main/scala/npc/lsu.scala:65:25, :102:17, :110:14
  wire [7:0]  _memory_ctl_io_wmask;	// src/main/scala/npc/lsu.scala:92:26
  wire [31:0] _memory_ctl_io_dmem_wdata;	// src/main/scala/npc/lsu.scala:92:26
  wire [2:0]  _memory_ctl_io_dmem_rw_size;	// src/main/scala/npc/lsu.scala:92:26
  wire [31:0] _alignment_network_io_data_out;	// src/main/scala/npc/lsu.scala:82:33
  reg  [31:0] lsu_reg_inst;	// src/main/scala/npc/lsu.scala:55:31
  reg  [31:0] lsu_reg_pc;	// src/main/scala/npc/lsu.scala:56:29
  reg  [31:0] lsu_reg_dmem_addr;	// src/main/scala/npc/lsu.scala:57:36
  reg  [31:0] lsu_reg_result;	// src/main/scala/npc/lsu.scala:58:33
  reg  [31:0] lsu_reg_rs2_data;	// src/main/scala/npc/lsu.scala:59:35
  reg  [4:0]  lsu_reg_wb_addr;	// src/main/scala/npc/lsu.scala:60:34
  wire [9:0]  _mem_access_control_T = {lsu_reg_inst[6:0], lsu_reg_inst[14:12]};	// src/main/scala/npc/lsu.scala:55:31, :63:28, :64:28, :70:38
  wire [2:0]  mem_access_control =
    _mem_access_control_T == 10'h119
      ? 3'h1
      : _mem_access_control_T == 10'h118
          ? 3'h0
          : _mem_access_control_T == 10'h11A
              ? 3'h2
              : _mem_access_control_T == 10'h1D
                  ? 3'h5
                  : _mem_access_control_T == 10'h19
                      ? 3'h1
                      : _mem_access_control_T == 10'h1C
                          ? 3'h4
                          : {1'h0,
                             _mem_access_control_T == 10'h18
                               ? 2'h0
                               : {_mem_access_control_T == 10'h1A, 1'h0}};	// src/main/scala/common/axi4.scala:73:18, src/main/scala/npc/lsu.scala:70:{38,60}, :71:8, :72:8, :73:8, :74:8, :75:8, :76:8, :77:8, :78:8
  reg  [31:0] delayedData;	// src/main/scala/npc/lsu.scala:87:28
  reg  [2:0]  state;	// src/main/scala/npc/lsu.scala:99:22
  wire        _GEN = state == 3'h0;	// src/main/scala/npc/lsu.scala:72:8, :99:22, :102:17
  wire        _GEN_0 = state == 3'h1;	// src/main/scala/npc/lsu.scala:74:8, :99:22, :102:17
  wire        _GEN_1 = state == 3'h2;	// src/main/scala/npc/lsu.scala:71:8, :99:22, :102:17
  wire        _GEN_2 = ~isLoad & isStore;	// src/main/scala/common/axi4.scala:73:18, src/main/scala/npc/lsu.scala:65:25, :66:25, :102:17, :110:14, :111:15, :154:22, :166:30
  wire        _GEN_3 = _GEN | _GEN_0;	// src/main/scala/common/axi4.scala:82:16, src/main/scala/npc/lsu.scala:102:17
  wire        _GEN_4 = _GEN_3 | ~_GEN_1 | isLoad | ~isStore;	// src/main/scala/common/axi4.scala:74:17, :82:16, src/main/scala/npc/lsu.scala:65:25, :66:25, :102:17, :110:14, :111:15, :154:22, :166:30
  wire        _GEN_5 = state == 3'h3;	// src/main/scala/npc/lsu.scala:99:22, :102:17, :164:19
  wire        _GEN_6 = _GEN_1 | _GEN_5;	// src/main/scala/common/axi4.scala:91:17, src/main/scala/npc/lsu.scala:102:17, :154:22, :157:29, :196:20, :198:27
  wire        _GEN_7 = _GEN_3 | ~(_GEN_6 & isLoad);	// src/main/scala/common/axi4.scala:82:16, :91:17, src/main/scala/npc/lsu.scala:65:25, :102:17, :110:14, :154:22, :157:29, :196:20, :198:27
  wire        _GEN_8 = _GEN_3 | ~_GEN_1 & ~_GEN_5 | isLoad | ~isStore;	// src/main/scala/common/axi4.scala:74:17, :82:16, src/main/scala/npc/lsu.scala:65:25, :66:25, :102:17, :110:14, :111:15, :154:22, :166:30, :196:20
  wire        _GEN_9 = isStore & io_memory_b_valid;	// src/main/scala/npc/lsu.scala:52:23, :66:25, :102:17, :111:15, :217:27, :230:33, :231:33
  wire        _GEN_10 = _GEN_0 | _GEN_1;	// src/main/scala/npc/lsu.scala:52:23, :102:17
  wire        _GEN_11 = _GEN | _GEN_10;	// src/main/scala/npc/lsu.scala:52:23, :102:17
  wire        _GEN_12 = state == 3'h4;	// src/main/scala/npc/lsu.scala:73:8, :99:22, :102:17
  wire        io_in_ready_0 = _GEN & io_in_valid;	// src/main/scala/npc/lsu.scala:102:17, :129:25
  assign isLoad =
    ~_GEN_3 & (_GEN_1 ? lsu_reg_inst[6:0] == 7'h3 : _GEN_5 & lsu_reg_inst[6:0] == 7'h3);	// src/main/scala/common/axi4.scala:82:16, src/main/scala/npc/lsu.scala:55:31, :63:28, :65:25, :71:8, :102:17, :110:14, :151:{16,26}, :193:{14,24}
  assign isStore =
    ~_GEN_3 & (_GEN_1 ? lsu_reg_inst[6:0] == 7'h23 : _GEN_5 & lsu_reg_inst[6:0] == 7'h23);	// src/main/scala/common/axi4.scala:82:16, src/main/scala/npc/lsu.scala:55:31, :63:28, :65:25, :66:25, :76:8, :102:17, :110:14, :111:15, :152:{17,27}, :194:{15,25}
  wire        io_memory_w_valid_0 = ~_GEN_3 & _GEN_1 & _GEN_2;	// src/main/scala/common/axi4.scala:73:18, :82:16, src/main/scala/npc/lsu.scala:65:25, :102:17, :110:14, :120:26, :154:22, :166:30
  always @(posedge clock) begin	// src/main/scala/npc/lsu.scala:42:7
    if (io_in_ready_0 & io_in_valid) begin	// src/main/scala/chisel3/util/Decoupled.scala:51:35, src/main/scala/npc/lsu.scala:102:17, :129:25
      lsu_reg_inst <= io_in_bits_inst;	// src/main/scala/npc/lsu.scala:55:31
      lsu_reg_pc <= io_in_bits_pc;	// src/main/scala/npc/lsu.scala:56:29
      lsu_reg_dmem_addr <= io_in_bits_dmem_addr;	// src/main/scala/npc/lsu.scala:57:36
      lsu_reg_result <= io_in_bits_result;	// src/main/scala/npc/lsu.scala:58:33
      lsu_reg_rs2_data <= io_in_bits_rs2_data;	// src/main/scala/npc/lsu.scala:59:35
      lsu_reg_wb_addr <= io_in_bits_wb_addr;	// src/main/scala/npc/lsu.scala:60:34
    end
    if (reset) begin	// src/main/scala/npc/lsu.scala:42:7
      delayedData <= 32'h0;	// src/main/scala/npc/lsu.scala:87:28
      state <= 3'h0;	// src/main/scala/npc/lsu.scala:72:8, :99:22
    end
    else begin	// src/main/scala/npc/lsu.scala:42:7
      delayedData <= _alignment_network_io_data_out;	// src/main/scala/npc/lsu.scala:82:33, :87:28
      if (_GEN) begin	// src/main/scala/npc/lsu.scala:102:17
        if (io_in_valid)	// src/main/scala/npc/lsu.scala:43:14
          state <= 3'h1;	// src/main/scala/npc/lsu.scala:74:8, :99:22
      end
      else if (_GEN_0) begin	// src/main/scala/npc/lsu.scala:102:17
        if (io_arbiter_ready)	// src/main/scala/npc/lsu.scala:43:14
          state <= 3'h2;	// src/main/scala/npc/lsu.scala:71:8, :99:22
      end
      else if (_GEN_1) begin	// src/main/scala/npc/lsu.scala:102:17
        if (isLoad) begin	// src/main/scala/npc/lsu.scala:65:25, :102:17, :110:14
          if (io_memory_ar_ready)	// src/main/scala/npc/lsu.scala:43:14
            state <= 3'h3;	// src/main/scala/npc/lsu.scala:99:22, :164:19
        end
        else if (isStore) begin	// src/main/scala/npc/lsu.scala:66:25, :102:17, :111:15
          if (io_memory_aw_ready & io_memory_w_ready)	// src/main/scala/npc/lsu.scala:178:35
            state <= 3'h3;	// src/main/scala/npc/lsu.scala:99:22, :164:19
        end
        else	// src/main/scala/npc/lsu.scala:66:25, :102:17, :111:15
          state <= 3'h4;	// src/main/scala/npc/lsu.scala:73:8, :99:22
      end
      else if (_GEN_5) begin	// src/main/scala/npc/lsu.scala:102:17
        if (isLoad ? io_memory_r_valid : _GEN_9)	// src/main/scala/npc/lsu.scala:52:23, :65:25, :99:22, :102:17, :110:14, :196:20, :207:33, :214:17, :217:27, :230:33, :231:33, :237:17
          state <= 3'h4;	// src/main/scala/npc/lsu.scala:73:8, :99:22
      end
      else if (_GEN_12 & io_out_ready)	// src/main/scala/npc/lsu.scala:99:22, :102:17, :267:26, :268:15
        state <= 3'h0;	// src/main/scala/npc/lsu.scala:72:8, :99:22
    end
  end // always @(posedge)
  AlignmentNetwork alignment_network (	// src/main/scala/npc/lsu.scala:82:33
    .io_data_in   (io_memory_r_data),
    .io_dmem_addr (lsu_reg_dmem_addr),	// src/main/scala/npc/lsu.scala:57:36
    .io_control   (mem_access_control),	// src/main/scala/npc/lsu.scala:70:60
    .io_data_out  (_alignment_network_io_data_out)
  );
  MemoryController memory_ctl (	// src/main/scala/npc/lsu.scala:92:26
    .io_dmem_addr      (lsu_reg_dmem_addr),	// src/main/scala/npc/lsu.scala:57:36
    .io_dmem_wdata_raw (lsu_reg_rs2_data),	// src/main/scala/npc/lsu.scala:59:35
    .io_control        (mem_access_control),	// src/main/scala/npc/lsu.scala:70:60
    .io_wmask          (_memory_ctl_io_wmask),
    .io_dmem_wdata     (_memory_ctl_io_dmem_wdata),
    .io_dmem_rw_size   (_memory_ctl_io_dmem_rw_size)
  );
  assign io_in_ready = io_in_ready_0;	// src/main/scala/npc/lsu.scala:42:7, :102:17, :129:25
  assign io_out_valid = ~(_GEN | _GEN_0 | _GEN_1 | _GEN_5) & _GEN_12;	// src/main/scala/npc/lsu.scala:42:7, :50:16, :102:17, :108:20, :149:22, :191:20
  assign io_out_bits_inst = lsu_reg_inst;	// src/main/scala/npc/lsu.scala:42:7, :55:31
  assign io_out_bits_pc = lsu_reg_pc;	// src/main/scala/npc/lsu.scala:42:7, :56:29
  assign io_out_bits_dmem_rdata = delayedData;	// src/main/scala/npc/lsu.scala:42:7, :87:28
  assign io_out_bits_result = lsu_reg_result;	// src/main/scala/npc/lsu.scala:42:7, :58:33
  assign io_out_bits_wb_addr = lsu_reg_wb_addr;	// src/main/scala/npc/lsu.scala:42:7, :60:34
  assign io_lsu_axi_resp_err =
    ~_GEN_11 & _GEN_5
    & (isLoad
         ? io_memory_r_valid & ((&io_memory_r_resp) | io_memory_r_resp == 2'h2)
         : _GEN_9 & ((&io_memory_b_resp) | io_memory_b_resp == 2'h2));	// src/main/scala/common/axi4.scala:76:17, src/main/scala/npc/lsu.scala:42:7, :52:23, :65:25, :102:17, :110:14, :196:20, :207:33, :208:{31,70}, :217:27, :230:33, :231:{33,72}
  assign io_memory_aw_addr = _GEN_8 ? 32'h0 : lsu_reg_dmem_addr;	// src/main/scala/common/axi4.scala:74:17, src/main/scala/npc/lsu.scala:42:7, :57:36, :87:28, :102:17
  assign io_memory_aw_size = _GEN_8 ? 3'h2 : _memory_ctl_io_dmem_rw_size;	// src/main/scala/common/axi4.scala:74:17, :76:17, src/main/scala/npc/lsu.scala:42:7, :71:8, :92:26, :102:17, :124:25
  assign io_memory_aw_valid = io_memory_w_valid_0;	// src/main/scala/common/axi4.scala:73:18, src/main/scala/npc/lsu.scala:42:7, :102:17, :120:26
  assign io_memory_w_data = _GEN_4 ? 32'h0 : _memory_ctl_io_dmem_wdata;	// src/main/scala/common/axi4.scala:82:16, src/main/scala/npc/lsu.scala:42:7, :87:28, :92:26, :102:17
  assign io_memory_w_strb = _GEN_4 ? 4'h0 : _memory_ctl_io_wmask[3:0];	// src/main/scala/common/axi4.scala:78:15, :82:16, :83:16, src/main/scala/npc/lsu.scala:42:7, :92:26, :102:17, :172:28
  assign io_memory_w_last = _GEN | ~_GEN_0 & (_GEN_6 ? _GEN_2 : _GEN_12);	// src/main/scala/common/axi4.scala:73:18, :84:16, :91:17, src/main/scala/npc/lsu.scala:42:7, :102:17, :127:24, :154:22, :157:29, :166:30, :196:20, :198:27
  assign io_memory_w_valid = io_memory_w_valid_0;	// src/main/scala/common/axi4.scala:73:18, src/main/scala/npc/lsu.scala:42:7, :102:17, :120:26
  assign io_memory_b_ready = ~_GEN_11 & _GEN_5 & _GEN_2;	// src/main/scala/common/axi4.scala:73:18, :87:17, src/main/scala/npc/lsu.scala:42:7, :52:23, :102:17, :122:25, :154:22, :166:30
  assign io_memory_ar_addr = _GEN_7 ? 32'h0 : lsu_reg_dmem_addr;	// src/main/scala/common/axi4.scala:91:17, src/main/scala/npc/lsu.scala:42:7, :57:36, :87:28, :102:17
  assign io_memory_ar_size = _GEN_7 ? 3'h2 : _memory_ctl_io_dmem_rw_size;	// src/main/scala/common/axi4.scala:91:17, :93:17, src/main/scala/npc/lsu.scala:42:7, :71:8, :92:26, :102:17, :116:25
  assign io_memory_ar_valid = ~_GEN_3 & _GEN_1 & isLoad;	// src/main/scala/common/axi4.scala:82:16, :90:18, src/main/scala/npc/lsu.scala:42:7, :65:25, :102:17, :110:14, :113:26
  assign io_memory_r_ready = ~_GEN_11 & _GEN_5 & isLoad;	// src/main/scala/common/axi4.scala:98:17, src/main/scala/npc/lsu.scala:42:7, :52:23, :65:25, :102:17, :110:14, :114:25
  assign io_arbiter_valid = ~_GEN & (_GEN_10 | _GEN_5);	// src/main/scala/npc/lsu.scala:42:7, :52:23, :102:17, :105:24, :137:24, :146:26
  assign io_lsu_state_debug = state;	// src/main/scala/npc/lsu.scala:42:7, :99:22
  assign io_lsu_is_ld_or_st_debug = isLoad | isStore;	// src/main/scala/npc/lsu.scala:42:7, :65:25, :66:25, :102:17, :110:14, :111:15, :281:38
  assign io_lsu_reg_inst_debug = lsu_reg_inst;	// src/main/scala/npc/lsu.scala:42:7, :55:31
  assign io_dmem_wdata_debug = _memory_ctl_io_dmem_wdata;	// src/main/scala/npc/lsu.scala:42:7, :92:26
  assign io_dmem_rdata_debug = io_memory_r_data;	// src/main/scala/npc/lsu.scala:42:7
  assign io_lsu_reg_dmem_addr_debug = lsu_reg_dmem_addr;	// src/main/scala/npc/lsu.scala:42:7, :57:36
endmodule

